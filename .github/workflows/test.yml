name: test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: dtolnay/rust-toolchain@stable
          
      # publish ourselves
      - name: Publish crates (dry-run)
        run: cargo run -p publish-crates-action
        env:
          INPUT_TOKEN: ${{ github.token }}
          INPUT_VERSION: latest
          INPUT_NO-VERIFY: true
          INPUT_RESOLVE-VERSIONS: true
          INPUT_DRY-RUN: true
        
      # publish ourselves
      - name: Publish crates (dry-run)
        run: cargo run -p cargo-publish-crates
        env:
          RESOLVE-VERSIONS: true
          DRY-RUN: true
          NO-VERIFY: true
